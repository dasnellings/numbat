<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Mouse tutorial • numbat</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mouse tutorial"><meta name="description" content="Haplotype-aware CNV analysis for mouse scRNA-seq"><meta property="og:description" content="Haplotype-aware CNV analysis for mouse scRNA-seq"><meta property="og:image" content="https://kharchenkolab.github.io/numbat/logo.png"><meta name="google-site-verification" content="GE78cdBqx5YPEbHjqtohe_p51Ng8oEPXdcaSEIu2dP8"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">numbat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/numbat.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/results.html">Interpreting Numbat results</a></li>
    <li><a class="dropdown-item" href="../articles/mouse.html">Mouse tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/spatial-rna.html">Spatial transcriptomics</a></li>
    <li><a class="dropdown-item" href="../articles/descriptions.html">File descriptions</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kharchenkolab/numbat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mouse tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/kharchenkolab/numbat/blob/HEAD/vignettes/mouse.Rmd" class="external-link"><code>vignettes/mouse.Rmd</code></a></small>
      <div class="d-none name"><code>mouse.Rmd</code></div>
    </div>

    
    
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@tGaoTeng" />
<meta name="twitter:title" content="Numbat mouse tutorial" />
<meta name="twitter:description" content="Haplotype-aware CNV analysis for mouse scRNA-seq" />
<meta name="twitter:image" content="https://www.jax.org/-/media/jaxweb/images/news-and-insights/black-6-mama.jpg" />
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The mouse is a major model system for studying cancer and many other areas of biology. According to the 10x <a href="https://www.10xgenomics.com/resources/publications?refinementList%5BproductGroups%5D%5B0%5D=Single%20Cell%20Gene%20Expression&amp;refinementList%5Btags%5D%5B0%5D=Cancer%20Research&amp;page=1">website</a>, there are almost as many cancer single-cell studies on mouse subjects as on humans.</p>
<p>Previously, we have shown that with prior haplotype information, Numbat can detect allele-specific CNVs at a much higher accuracy <a href="#references">[1]</a>. Although we don’t usually know the haplotype of a given human subject <em>a priori</em>, it can be “guessed” statistically using <a href="https://en.wikipedia.org/wiki/Haplotype_estimation">population-based phasing</a>. The resulting haplotypes are reasonably accurate within short blocks (&lt;1Mb), but are subject to switch errors over a longer range. The mouse is a special case because the haplotypes of most common laboratory strains are fully known (thanks to the mouse genome projects <a href="#references">[2,3]</a>). This means that all heterozygous SNPs in a F1 hybrid mouse of two inbred strains are <em>fully phased</em> at whole-genome level. In addition, the SNP density in a F1 hybrid mouse can be many times higher than in humans <a href="#references">[2]</a>. As we will see, these factors provide a huge advantage for haplotype-aware CNV analysis.</p>
<p>The most updated version of Numbat (v1.2.0) now accepts (F1 hybrid) mouse data. The input format is the same as usual (expression counts in a matrix, allele counts in a long dataframe), but some bioinformatics is required to prepare the phased allele counts. This tutorial will walk through data prepration to analyze a mouse PDAC scRNA-seq dataset provided by <a href="https://doi.org/10.1158/0008-5472.CAN-22-1742">Pitter et al</a> <a href="#references">[4]</a>.</p>
</div>
<div id="preparing-input" class="section level1">
<h1>Preparing input</h1>
<div id="prepare-the-vcf" class="section level2">
<h2>1. Prepare the VCF</h2>
<p>First, find out the parental strains of your F1 mouse. In the case of Pitter et al, the mice are of C57BL/6 x Sv129 mixed genetic background. This is convenient because the genome of C57BL/6 (aka <a href="https://www.jax.org/news-and-insights/2019/june/the-genome-of-eve-the-mouse">Eve</a> the mouse) <em>is</em> the mm10 reference genome. This means that all heterozygous SNPs in the F1 are the homozygous SNPs in Sv129. To create the F1 VCF, we just need to take the Sv129 VCF and change the genotype of homozygous SNPs (1/1) to heterozygous (1/0).</p>
<p>The VCFs of common lab mouse strains are available on <a href="http://hgdownload.soe.ucsc.edu/gbdb/mm10/mouseStrains/">UCSC portal</a>. I downloaded the all-strain VCF (<code>mgpV5MergedSNPsAlldbSNP142.vcf.gz</code>) and extracted the passed homozygous sites for Sv129 using <code>bcftools</code>:</p>
<pre class="shell"><code>bcftools view mgpV5MergedSNPsAlldbSNP142.vcf.gz -c1 -s 129S1_SvImJ \
    -i &quot;%FILTER=&#39;PASS&#39;&quot; | \
    bcftools annotate -Oz -x INFO,^FORMAT/GT &gt; 129S1_SvImJ.sites.vcf.gz</code></pre>
<p>We can then use <code>129S1_SvImJ.sites.vcf.gz</code> as the VCF for our F1 mouse (except that all GT has to be changed to <code>1/0</code>).</p>
<p><em>Note</em>: This is slightly more complicated if neither parental strain is C57BL/6. One would have to find the SNPs that are homozygous only in one parent but not both.</p>
</div>
<div id="run-pileup" class="section level2">
<h2>2. Run pileup</h2>
<p>For samples in this study, I downloaded raw FASTQs from the <a href="https://www.ebi.ac.uk/ena/browser/view/PRJNA861311">SRA</a> and processed them by <code>cellranger</code>. Now we can generate single-cell allele counts for the SNP positions in the above VCF using <code>cellsnp-lite</code>.</p>
<pre class="shell"><code>cellsnp-lite \
    -s $cellrangerout/outs/possorted_genome_bam.bam \
    -b $cellrangerout/outs/filtered_feature_bc_matrix/barcodes.tsv.gz \
    -O ./pileup \
    -R ./129S1_SvImJ.sites.vcf.gz \
    -p 25 \
    --minMAF 0 \
    --minCOUNT 1</code></pre>
<p>where <code>$cellrangerout</code> is the cellranger output folder for a specific sample.</p>
</div>
<div id="prepare-allele-dataframe" class="section level2">
<h2>3. Prepare allele dataframe</h2>
<p>Let’s now read in the pileup output in R.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>pu_dir <span class="ot">=</span> <span class="st">&#39;./pileup&#39;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>vcf_pu <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">glue</span>(<span class="st">&#39;{pu_dir}/cellSNP.base.vcf&#39;</span>), <span class="at">skip =</span> <span class="st">&#39;#CHROM&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">CHROM =</span> <span class="st">`</span><span class="at">#CHROM</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">snp_id =</span> <span class="fu">paste</span>(CHROM, POS, REF, ALT, <span class="at">sep =</span> <span class="st">&#39;_&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CHROM =</span> <span class="fu">str_remove</span>(CHROM, <span class="st">&#39;chr&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">CHROM =</span> <span class="fu">factor</span>(CHROM, <span class="fu">unique</span>(CHROM))) <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(CHROM <span class="sc">!=</span> <span class="st">&#39;X&#39;</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>vcf_phased <span class="ot">=</span> vcf_pu <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">GT =</span> <span class="st">&#39;1|0&#39;</span>, <span class="at">cM =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>where the last line is because one of the parental genotypes is the mm10 reference genome, all the alternative alleles in the VCF are already <em>in phase</em>, so all GT should be <code>1|0</code>. In addition, since there is no recombination, we set the genetic distance <code>cM</code> to be a constant value for all sites.</p>
<p><em>Note</em>: Again, if neither parental strain is C57BL/6, one has to assign GT to be <code>1|0</code> or <code>0|1</code> based on which parent the variant came from.</p>
<p>Next, we can read in the allele counts and convert it into a long dataframe.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pileup count matrices</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>AD <span class="ot">=</span> <span class="fu">readMM</span>(<span class="fu">glue</span>(<span class="st">&#39;{pu_dir}/cellSNP.tag.AD.mtx&#39;</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>DP <span class="ot">=</span> <span class="fu">readMM</span>(<span class="fu">glue</span>(<span class="st">&#39;{pu_dir}/cellSNP.tag.DP.mtx&#39;</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>barcodes <span class="ot">=</span> <span class="fu">fread</span>(<span class="fu">glue</span>(<span class="st">&#39;{pu_dir}/cellSNP.samples.tsv&#39;</span>), <span class="at">header =</span> F)<span class="sc">$</span>V1</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to dataframe</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>DP <span class="ot">=</span> <span class="fu">as.data.frame</span>(Matrix<span class="sc">::</span><span class="fu">summary</span>(DP)) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">cell =</span> barcodes[j],</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">snp_id =</span> vcf_pu<span class="sc">$</span>snp_id[i]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>i, <span class="sc">-</span>j) <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">DP =</span> x) <span class="sc">%&gt;%</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(cell, snp_id, DP)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>AD <span class="ot">=</span> <span class="fu">as.data.frame</span>(Matrix<span class="sc">::</span><span class="fu">summary</span>(AD)) <span class="sc">%&gt;%</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">cell =</span> barcodes[j],</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">snp_id =</span> vcf_pu<span class="sc">$</span>snp_id[i]</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>i, <span class="sc">-</span>j) <span class="sc">%&gt;%</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">AD =</span> x) <span class="sc">%&gt;%</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(cell, snp_id, AD)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>df_allele <span class="ot">=</span> DP <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(AD, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;cell&quot;</span>, <span class="st">&quot;snp_id&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">AD =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(AD), <span class="dv">0</span>, AD))</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co"># attach genotype info</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>df_allele <span class="ot">=</span> df_allele <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    vcf_phased <span class="sc">%&gt;%</span> <span class="fu">select</span>(snp_id, CHROM, POS, REF, ALT, GT, cM),</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&#39;snp_id&#39;</span>)</span></code></pre></div>
</div>
<div id="prepare-the-expression-reference" class="section level2">
<h2>4. Prepare the expression reference</h2>
<p>Because these are pancreatic tumors (PDAC), I downloaded the expression counts for a mouse normal pancreas scRNA-seq dataset (<a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE159343">GSE159343</a>), ran clustering using <code>pagoda2</code>, and used it to construct the reference expression profile (<code>ref_pancreas</code>).</p>
<pre><code>count_mat = readMM(&#39;~/GSE159343_RAW/GSM4826923_C57BL6J_matrix.mtx.gz&#39;)
cells = fread(&#39;~/GSE159343_RAW/GSM4826923_C57BL6J_cells.tsv.gz&#39;, header = F)$V1
genes = fread(&#39;~/GSE159343_RAW/GSM4826923_C57BL6J_genes.tsv.gz&#39;, header = F)$V2
colnames(count_mat) = cells
rownames(count_mat) = genes
count_mat = as.matrix(count_mat)
count_mat = rowsum(count_mat, rownames(count_mat))
count_mat = as(count_mat, &quot;dgCMatrix&quot;)
count_mat_ref = count_mat

p2 = pagoda2::basicP2proc(count_mat_ref, n.cores = 30)

clusters = p2$clusters$PCA$multilevel

ref_annot = data.frame(
    cell = names(clusters),
    group = unname(clusters)
)

ref_pancreas = numbat::aggregate_counts(
    count_mat_ref,
    ref_annot %&gt;% group_by(group) %&gt;% filter(n() &gt; 100)
)</code></pre>
<p>The expression count matrices for the tumor samples are prepared from the cellranger output as usual.</p>
</div>
</div>
<div id="run-numbat" class="section level1">
<h1>Run Numbat</h1>
<p>Finally, let’s run CNV analysis using the prepared data. To let Numbat know this is mouse data, we set the genome build as <code>mm10</code> and set phase switch rate <code>nu = 0</code> to disable phase switch (because the phasing is perfect!).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">run_numbat</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    count_mat_tumor, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    ref_pancreas, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    df_allele,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">t =</span> <span class="fl">1e-5</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncores =</span> <span class="dv">20</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">skip_nj =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_LLR =</span> <span class="dv">30</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">out_dir =</span> <span class="st">&#39;./results&#39;</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mouse specific settings</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">genome =</span> <span class="st">&quot;mm10&quot;</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">nu =</span> <span class="dv">0</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="results" class="section level1">
<h1>Results</h1>
<p>Let’s look at the results for sample KPT_062521 (SRR20462475), where we see tumor subclones with distinct copy number profiles (the majority of the events are copy-neutral LOH).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">=</span> Numbat<span class="sc">$</span><span class="fu">new</span>(<span class="fu">glue</span>(<span class="st">&#39;./results/{sample}&#39;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.width =</span> <span class="dv">8</span>, <span class="at">repr.plot.height =</span> <span class="dv">4</span>, <span class="at">repr.plot.res =</span> <span class="dv">200</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>clone_pal <span class="ot">=</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;gray&#39;</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#E41A1C&quot;</span>, <span class="st">`</span><span class="at">3</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#377EB8&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">4</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#4DAF4A&quot;</span>, <span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;#984EA3&quot;</span>, <span class="st">`</span><span class="at">6</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;bisque3&#39;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>nb<span class="sc">$</span><span class="fu">plot_phylo_heatmap</span>(<span class="at">pal_clone =</span> clone_pal, <span class="at">clone_stack =</span> <span class="cn">TRUE</span>, <span class="at">p_min =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<p><img src="https://i.imgur.com/UWuz9MT.png" /></p>
<p>Let’s compare the copy number profiles of the two major subclones (clone 4 and 5) in a pseudobulk HMM view.</p>
<pre><code>options(repr.plot.width = 10, repr.plot.height = 4.5, repr.plot.res = 200)

nb$bulk_clones %&gt;% filter(sample %in% c(4,5)) %&gt;% 
filter(CHROM %in% c(3, 4, 9)) %&gt;%
plot_bulks(min_depth = 15, use_pos = F, exp_limit = 2.5, min_LLR = 20)</code></pre>
<p><img src="https://i.imgur.com/tdtW7DY.png" /></p>
<p>We see haplotype-specific differences with remarkable resolution. For example, the subclonal copy number profiles for chr3 largely agree, whereas chr4 and chr9 have distinct breakpoints and mirorred CNLOH (chr4, middle segment). All alleles collapse to one side in a CNV region, thanks to the perfect phasing.</p>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>Haplotype-aware CNV analysis is espcially powerful for model systems (the mouse in particular) where the haplotypes are fully known. Luckily, the logic in Numbat are written generically enough such that minimal tweaking to the algorithm is required (simply setting phase switch rate to be zero is sufficient, making it a special case). The main limitation is that Numbat is only applicable to F1 hybrid mice with mixed genetic backgrounds, whereas many mouse tumor models are conducted on a inbred (pure) genetic background, which lacks heterozygous SNPs. Nonetheless, this extension opens up many oppurtunities for integrative single-cell analysis in a genetically manipulatable mammalian system.</p>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<ol style="list-style-type: decimal">
<li><p>Gao, T., Soldatov, R., Sarkar, H. et al. Haplotype-aware analysis of somatic copy number variations from single-cell transcriptomes. Nat Biotechnol (2022). <a href="https://doi.org/10.1038/s41587-022-01468-y" class="uri">https://doi.org/10.1038/s41587-022-01468-y</a></p></li>
<li><p>Keane, T., Goodstadt, L., Danecek, P. et al. Mouse genomic variation and its effect on phenotypes and gene regulation. Nature 477, 289–294 (2011). <a href="https://doi.org/10.1038/nature10413" class="uri">https://doi.org/10.1038/nature10413</a></p></li>
<li><p>Lilue, J., Doran, A.G., Fiddes, I.T. et al. Sixteen diverse laboratory mouse reference genomes define strain-specific haplotypes and novel functional loci. Nat Genet 50, 1574–1583 (2018). <a href="https://doi.org/10.1038/s41588-018-0223-8" class="uri">https://doi.org/10.1038/s41588-018-0223-8</a></p></li>
<li><p>Kenneth L. Pitter, et al. Systematic Comparison of Pancreatic Ductal Adenocarcinoma Models Identifies a Conserved Highly Plastic Basal Cell State. Cancer Res 1 October 2022; 82 (19): 3549–3560. <a href="https://doi.org/10.1158/0008-5472.CAN-22-1742" class="uri">https://doi.org/10.1158/0008-5472.CAN-22-1742</a></p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Teng Gao, Ruslan Soldatov, Hirak Sarkar, Evan Biederstedt, Peter Kharchenko.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>
